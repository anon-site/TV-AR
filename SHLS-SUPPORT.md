# دعم SHLS Streams في NOON TV

## المشكلة التي تم حلها

كان الرابط `https://shls-live-enc.edgenextcdn.net/out/v1/46079e838e65490c8299f902a7731168/index_1.m3u8` لا يعمل بسبب مشاكل في التعامل مع الوكلاء (proxies) لملفات M3U8، خاصة على السيرفر المرفوع عليه الموقع.

## الحل المطبق

### 1. كشف البيئة التلقائي
- **البيئة المحلية**: استخدام الوصول المباشر للرابط
- **البيئة السيرفر**: استخدام الوكلاء المتعددة للتحايل على CORS

### 2. دعم متعدد المستويات للوكلاء
عند العمل على السيرفر، يتم تجربة الوكلاء التالية بالترتيب:
- `https://api.allorigins.win/get?url=`
- `https://cors-anywhere.herokuapp.com/`
- `https://api.codetabs.com/v1/proxy?quest=`
- `https://thingproxy.freeboard.io/fetch/`
- `https://corsproxy.io/?`

### 3. تحسينات HLS.js
- إضافة إعدادات CORS خاصة للبيئة السيرفر
- معالجة أفضل للأخطاء مع رسائل واضحة
- تنظيف أفضل لـ HLS instances

### 4. معالجة الأخطاء المحسنة
- رسائل خطأ مختلفة حسب البيئة
- إمكانية إعادة المحاولة
- معلومات تشخيصية مفصلة

## كيفية الاستخدام

### إضافة قناة جديدة
1. افتح لوحة التحكم
2. اضغط على "إضافة قناة"
3. أدخل الرابط الذي يبدأ بـ `shls-live-enc.edgenextcdn.net`
4. سيتم كشف النوع تلقائياً كـ "SHLS Stream"

### اختبار الوظيفة
1. افتح ملف `test-shls.html` في المتصفح
2. اضغط على "تحميل الفيديو" لاختبار الرابط
3. راقب رسائل الحالة في منطقة النتائج
4. تحقق من نوع البيئة (محلي/سيرفر) في معلومات المتصفح

## الملفات المحدثة

- `script.js`: دالة `loadShlsVideo` محدثة مع دعم البيئة السيرفر
- `channels.json`: قناة تجريبية مضافة
- `test-shls.html`: ملف اختبار محدث مع دعم البيئة السيرفر
- `index.html`: نص المساعدة محدث
- `SHLS-SUPPORT.md`: دليل الاستخدام محدث

## ملاحظات مهمة

### البيئة المحلية
- الرابط يعمل بشكل مباشر بدون وكلاء
- أفضل أداء وأقل تأخير

### البيئة السيرفر
- يتم استخدام الوكلاء تلقائياً
- قد يكون هناك تأخير طفيف بسبب الوكلاء
- في حالة فشل جميع الوكلاء، يتم المحاولة المباشرة

### استكشاف الأخطاء

إذا لم يعمل الرابط:
1. **تحقق من البيئة**: افتح console المتصفح لرؤية رسائل التشخيص
2. **تحقق من الوكلاء**: راقب أي رسائل خطأ من الوكلاء
3. **جرب VPN**: بعض الروابط قد تحتاج VPN
4. **تحقق من الرابط**: تأكد من أن الرابط صالح ومتاح
5. **جرب متصفح مختلف**: بعض المتصفحات قد تعمل بشكل أفضل

### رسائل التشخيص

في console المتصفح، ستجد رسائل مثل:
- `🏠 تم الكشف عن البيئة المحلية - استخدام الوصول المباشر...`
- `🌐 تم الكشف عن السيرفر - استخدام الوكلاء...`
- `✅ نجح التحميل مع وكيل: [اسم الوكيل]`
- `❌ فشل مع وكيل: [اسم الوكيل] - [سبب الخطأ]`

## الخلاصة

الآن يجب أن يعمل الرابط `https://shls-live-enc.edgenextcdn.net/out/v1/46079e838e65490c8299f902a7731168/index_1.m3u8` بشكل صحيح على كل من البيئة المحلية والسيرفر! 🎉