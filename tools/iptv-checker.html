<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مشغل IPTV المباشر - القنوات العربية</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        /* IPTV Player Specific Styles */
        .iptv-checker-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Video Player Styles */
        .video-player-section {
            background: var(--secondary-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .video-player-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #059669, #10b981);
        }

        .player-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .video-wrapper {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .video-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
        }

        .player-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, transparent 30%, transparent 70%, rgba(0,0,0,0.7) 100%);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .video-wrapper:hover .player-overlay {
            opacity: 1;
            pointer-events: auto;
        }

        .player-info {
            color: white;
        }

        .player-info h3 {
            margin: 0 0 5px 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .player-info p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.8;
            word-break: break-all;
        }

        .player-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }

        .control-btn {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .player-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding: 15px;
            background: var(--background-dark);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            font-size: 0.8rem;
            transition: color 0.3s ease;
        }

        .status-dot.playing {
            color: #10b981;
            animation: pulse 2s infinite;
        }

        .status-dot.paused {
            color: #f59e0b;
        }

        .status-dot.error {
            color: #ef4444;
        }

        .status-dot.loading {
            color: #3b82f6;
            animation: spin 1s linear infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .quality-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quality-selector {
            padding: 5px 10px;
            background: var(--accent-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quality-selector:hover {
            background: var(--highlight-color);
            color: white;
        }

        /* Channels Management Styles */
        .channels-section {
            background: var(--secondary-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .channels-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #8b5cf6, #7c3aed, #8b5cf6);
        }

        .channels-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .channels-header h3 {
            color: var(--text-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .channels-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .channels-tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .channel-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1rem;
            position: relative;
            border-radius: 8px 8px 0 0;
        }

        .channel-tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: var(--highlight-color);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .channel-tab.active {
            color: var(--highlight-color);
            background: rgba(233, 69, 96, 0.1);
        }

        .channel-tab.active::before {
            width: 80%;
        }

        .channel-tab:hover {
            color: var(--text-primary);
            background: rgba(233, 69, 96, 0.05);
        }

        .channel-tab-content {
            display: none;
        }

        .channel-tab-content.active {
            display: block;
        }

        .channels-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .channel-item {
            background: var(--background-dark);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--highlight-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .channel-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--highlight-color), #ff6b7a);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .channel-item:hover::before {
            transform: scaleX(1);
        }

        .channel-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .channel-item.working {
            border-left-color: #10b981;
        }

        .channel-item.broken {
            border-left-color: #ef4444;
        }

        .channel-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .channel-name {
            color: var(--text-primary);
            font-weight: 600;
            flex: 1;
            margin-right: 15px;
        }

        .channel-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .channel-status.working {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }

        .channel-status.broken {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
        }

        .channel-url {
            color: var(--text-secondary);
            font-size: 0.85rem;
            word-break: break-all;
            margin-bottom: 8px;
            padding: 8px 12px;
            background: var(--accent-color);
            border-radius: 6px;
            transition: all 0.3s ease;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .channel-url:hover {
            background: var(--highlight-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(233, 69, 96, 0.3);
        }

        .channel-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            opacity: 0;
            transition: all 0.3s ease;
            transform: translateY(10px);
        }

        .channel-item:hover .channel-actions {
            opacity: 1;
            transform: translateY(0);
        }

        .channel-action-btn {
            padding: 6px 12px;
            background: linear-gradient(135deg, var(--accent-color), #4a5568);
            color: var(--text-primary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .channel-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .channel-action-btn:hover::before {
            left: 100%;
        }

        .channel-action-btn i, .channel-action-btn span {
            position: relative;
            z-index: 1;
        }

        .channel-action-btn:hover {
            background: linear-gradient(135deg, var(--highlight-color), #e53e3e);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(233, 69, 96, 0.3);
        }

        .channel-action-btn:active {
            transform: translateY(0);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 1.1rem;
            margin: 0;
        }

        .checker-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .checker-header h1 {
            font-size: 2.5rem;
            color: var(--highlight-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .checker-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .checker-form {
            background: var(--secondary-color);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .checker-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--highlight-color), #ff6b7a, var(--highlight-color));
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .url-input-container {
            position: relative;
            display: flex;
            gap: 12px;
            align-items: stretch;
        }

        .url-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--background-dark);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .url-input:focus {
            outline: none;
            border-color: var(--highlight-color);
            box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.1), 0 4px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .url-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .check-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--highlight-color), #ff6b7a);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(233, 69, 96, 0.3);
            min-width: 140px;
            justify-content: center;
        }

        .check-btn:hover {
            background: linear-gradient(135deg, #d6336c, #c53030);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(233, 69, 96, 0.4);
        }

        .check-btn:active {
            transform: translateY(0);
        }

        .check-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .supported-formats {
            background: var(--accent-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 30px;
        }

        .supported-formats h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .formats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .format-item {
            background: var(--background-dark);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: var(--transition);
        }

        .format-item:hover {
            background: var(--highlight-color);
            color: white;
        }

        .format-item i {
            font-size: 2rem;
            color: var(--highlight-color);
            margin-bottom: 8px;
        }

        .format-item span {
            display: block;
            color: var(--text-primary);
            font-weight: 600;
        }

        .results-container {
            background: var(--secondary-color);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            display: none;
        }

        .results-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #059669, #10b981);
        }

        .results-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .results-title {
            font-size: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .status-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .status-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 3px 8px rgba(16, 185, 129, 0.3);
        }

        .status-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 3px 8px rgba(239, 68, 68, 0.3);
        }

        .status-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            box-shadow: 0 3px 8px rgba(245, 158, 11, 0.3);
        }

        .status-loading {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 3px 8px rgba(59, 130, 246, 0.3);
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .detail-item {
            background: var(--background-dark);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--highlight-color);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .detail-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--highlight-color), #ff6b7a);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .detail-item:hover::before {
            transform: scaleX(1);
        }

        .detail-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .detail-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .detail-item:hover .detail-label {
            color: var(--text-primary);
        }

        .detail-value {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .detail-item:hover .detail-value {
            color: var(--highlight-color);
            transform: scale(1.02);
        }

        .stream-info {
            background: var(--background-dark);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .stream-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .stream-info h4 {
            color: var(--text-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quality-levels {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .quality-badge {
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--accent-color), #4a5568);
            color: var(--text-primary);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            display: inline-block;
        }

        .quality-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .actions-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .actions-container .action-btn {
            min-width: 160px;
            justify-content: center;
            padding: 15px 25px;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .actions-container .action-btn i {
            font-size: 1.1rem;
            margin-left: 8px;
        }

        .actions-container .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn i, .action-btn span {
            position: relative;
            z-index: 1;
        }

        .play-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .play-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.3);
        }

        .copy-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .copy-btn:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.3);
        }

        .test-btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .test-btn:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.3);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .error-details {
            background: #fee2e2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .error-details h4 {
            color: #dc2626;
            margin-bottom: 10px;
        }

        .error-details p {
            color: #991b1b;
            margin-bottom: 5px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .back-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--highlight-color), #ff6b7a);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(233, 69, 96, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-btn:hover {
            background: linear-gradient(135deg, #d6336c, #c53030);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 16px rgba(233, 69, 96, 0.4);
        }

        .back-btn:active {
            transform: translateY(0) scale(1);
        }


        .quick-tests {
            background: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .quick-tests h3 {
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .quick-test-btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, var(--accent-color), #4a5568);
            color: var(--text-primary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            min-width: 160px;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .quick-test-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .quick-test-btn:hover::before {
            left: 100%;
        }

        .quick-test-btn i {
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }

        .quick-test-btn span {
            position: relative;
            z-index: 1;
        }

        .quick-test-btn:hover {
            background: linear-gradient(135deg, var(--highlight-color), #e53e3e);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(233, 69, 96, 0.3);
        }

        .quick-test-btn:active {
            transform: translateY(-1px);
        }

        /* File Checker Styles */
        .file-checker {
            background: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .file-checker h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-checker p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            background: var(--background-dark);
            transition: border-color 0.2s ease;
        }

        .file-upload-area:hover {
            border-color: var(--highlight-color);
        }

        .file-upload-area.dragover {
            border-color: var(--highlight-color);
            background: rgba(233, 69, 96, 0.05);
        }

        .upload-content i {
            font-size: 3rem;
            color: var(--highlight-color);
            margin-bottom: 16px;
            display: block;
        }

        .upload-content h4 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .upload-content p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .upload-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--highlight-color), #ff6b7a);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0 auto;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(233, 69, 96, 0.3);
            position: relative;
            overflow: hidden;
        }

        .upload-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .upload-btn:hover::before {
            left: 100%;
        }

        .upload-btn i, .upload-btn span {
            position: relative;
            z-index: 1;
        }

        .upload-btn:hover {
            background: linear-gradient(135deg, #d6336c, #c53030);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(233, 69, 96, 0.4);
        }

        .upload-btn:active {
            transform: translateY(0);
        }

        .file-info {
            background: var(--background-dark);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
        }

        .file-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .file-name, .file-size, .file-links-count {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .file-name i {
            color: var(--highlight-color);
        }

        .file-size i {
            color: #3b82f6;
        }

        .file-links-count i {
            color: #10b981;
        }

        .file-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .file-actions .action-btn {
            min-width: 180px;
            justify-content: center;
            padding: 15px 25px;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .file-actions .action-btn i {
            font-size: 1.1rem;
            margin-left: 8px;
        }

        .file-actions .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .file-results-container {
            background: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .file-status-badge {
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .file-status-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .file-progress {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--background-dark);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--highlight-color), #ff6b7a);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .file-summary {
            background: var(--background-dark);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: var(--accent-color);
            border-radius: 8px;
        }

        .stat-item i {
            font-size: 2rem;
            margin-bottom: 8px;
            display: block;
        }

        .stat-item i.fa-check-circle {
            color: #10b981;
        }

        .stat-item i.fa-times-circle {
            color: #ef4444;
        }

        .stat-item i.fa-clock {
            color: #3b82f6;
        }

        .stat-label {
            display: block;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .stat-value {
            display: block;
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .links-results {
            max-height: 400px;
            overflow-y: auto;
        }

        .link-result-item {
            background: var(--background-dark);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .link-result-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--border-color), var(--border-color));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .link-result-item.working {
            border-left-color: #10b981;
        }

        .link-result-item.working::before {
            background: linear-gradient(90deg, #10b981, #059669);
            transform: scaleX(1);
        }

        .link-result-item.broken {
            border-left-color: #ef4444;
        }

        .link-result-item.broken::before {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            transform: scaleX(1);
        }

        .link-result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .link-result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .link-name {
            color: var(--text-primary);
            font-weight: 600;
            flex: 1;
            margin-right: 15px;
        }

        .link-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .link-status.working {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }

        .link-status.broken {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
        }

        .link-status:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .link-url {
            color: var(--text-secondary);
            font-size: 0.85rem;
            word-break: break-all;
            margin-bottom: 8px;
            cursor: pointer;
            padding: 8px 12px;
            background: var(--accent-color);
            border-radius: 6px;
            transition: all 0.3s ease;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .link-url:hover {
            background: var(--highlight-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(233, 69, 96, 0.3);
        }

        .link-url.copied {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
        }

        .link-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            font-size: 0.8rem;
        }

        .link-detail {
            color: var(--text-secondary);
        }

        .link-detail strong {
            color: var(--text-primary);
        }

        /* Advanced Checker Styles */
        .advanced-checker-content {
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .advanced-checker-body {
            padding: 20px;
        }

        .checker-tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .checker-tab {
            padding: 15px 25px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1rem;
            position: relative;
            border-radius: 8px 8px 0 0;
        }

        .checker-tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: var(--highlight-color);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .checker-tab.active {
            color: var(--highlight-color);
            background: rgba(233, 69, 96, 0.1);
        }

        .checker-tab.active::before {
            width: 80%;
        }

        .checker-tab:hover {
            color: var(--text-primary);
            background: rgba(233, 69, 96, 0.05);
        }

        .checker-tab-content {
            display: none;
        }

        .checker-tab-content.active {
            display: block;
        }

        .advanced-form, .multiple-urls-form, .comparison-form {
            background: var(--background-dark);
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .advanced-input, .advanced-textarea, .advanced-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--secondary-color);
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
        }

        .advanced-input:focus, .advanced-textarea:focus, .advanced-select:focus {
            outline: none;
            border-color: var(--highlight-color);
            box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.1);
        }

        .advanced-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .check-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--accent-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .option-item:hover {
            background: var(--highlight-color);
            color: white;
        }

        .option-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--highlight-color);
        }

        .advanced-check-btn {
            width: 100%;
            padding: 15px 25px;
            background: linear-gradient(135deg, var(--highlight-color), #ff6b7a);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(233, 69, 96, 0.3);
            position: relative;
            overflow: hidden;
        }

        .advanced-check-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .advanced-check-btn:hover::before {
            left: 100%;
        }

        .advanced-check-btn i, .advanced-check-btn span {
            position: relative;
            z-index: 1;
        }

        .advanced-check-btn:hover {
            background: linear-gradient(135deg, #d6336c, #c53030);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(233, 69, 96, 0.4);
        }

        .advanced-check-btn:active {
            transform: translateY(0);
        }

        .comparison-urls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .comparison-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .history-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .history-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--accent-color), #4a5568);
            color: var(--text-primary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .history-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .history-btn:hover::before {
            left: 100%;
        }

        .history-btn i, .history-btn span {
            position: relative;
            z-index: 1;
        }

        .history-btn:hover {
            background: linear-gradient(135deg, var(--highlight-color), #e53e3e);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(233, 69, 96, 0.3);
        }

        .history-btn:active {
            transform: translateY(0);
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: var(--background-dark);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--highlight-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .history-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--highlight-color), #ff6b7a);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .history-item:hover::before {
            transform: scaleX(1);
        }

        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-url {
            color: var(--text-primary);
            font-weight: 600;
            word-break: break-all;
            transition: all 0.3s ease;
        }

        .history-item:hover .history-url {
            color: var(--highlight-color);
        }

        .history-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .history-status.success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }

        .history-status.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
        }

        .history-status:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .history-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .history-item:hover .history-details {
            color: var(--text-primary);
        }

        .history-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            opacity: 0;
            transition: all 0.3s ease;
            transform: translateY(10px);
        }

        .history-item:hover .history-actions {
            opacity: 1;
            transform: translateY(0);
        }

        .history-action-btn {
            padding: 8px 14px;
            background: linear-gradient(135deg, var(--accent-color), #4a5568);
            color: var(--text-primary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .history-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .history-action-btn:hover::before {
            left: 100%;
        }

        .history-action-btn i, .history-action-btn span {
            position: relative;
            z-index: 1;
        }

        .history-action-btn:hover {
            background: linear-gradient(135deg, var(--highlight-color), #e53e3e);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(233, 69, 96, 0.3);
        }

        .history-action-btn:active {
            transform: translateY(0);
        }

        /* Results Comparison Styles */
        .comparison-results {
            background: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-top: 20px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .comparison-item-result {
            background: var(--background-dark);
            border-radius: 8px;
            padding: 20px;
            border: 2px solid var(--border-color);
        }

        .comparison-item-result.better {
            border-color: #10b981;
        }

        .comparison-item-result.worse {
            border-color: #ef4444;
        }

        .comparison-score {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .comparison-score.high {
            color: #10b981;
        }

        .comparison-score.medium {
            color: #f59e0b;
        }

        .comparison-score.low {
            color: #ef4444;
        }

        /* Quality Analysis Styles */
        .quality-analysis {
            background: var(--background-dark);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .quality-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .quality-metric {
            text-align: center;
            padding: 15px;
            background: var(--accent-color);
            border-radius: 8px;
        }

        .quality-metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--highlight-color);
            margin-bottom: 5px;
        }

        .quality-metric-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .quality-chart {
            height: 200px;
            background: var(--secondary-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Quick Actions Styles */
        .quick-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
            padding: 15px;
            background: var(--background-dark);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .quick-action-btn {
            padding: 10px 18px;
            background: linear-gradient(135deg, var(--accent-color), #4a5568);
            color: var(--text-primary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 100px;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .quick-action-btn:hover {
            background: linear-gradient(135deg, var(--highlight-color), #e53e3e);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .quick-action-btn:active {
            transform: translateY(0);
        }

        /* Statistics Dashboard Styles */
        .stats-dashboard {
            background: var(--secondary-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .stats-dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #2563eb, #3b82f6);
        }

        .stats-dashboard h3 {
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: var(--background-dark);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            border-left: 4px solid var(--highlight-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--highlight-color), #ff6b7a);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--highlight-color), #ff6b7a);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(233, 69, 96, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(233, 69, 96, 0.4);
        }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .stat-card:hover .stat-value {
            color: var(--highlight-color);
            transform: scale(1.05);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .stat-card:hover .stat-label {
            color: var(--text-primary);
        }

        /* Enhanced Results Styles */
        .enhanced-results {
            background: var(--secondary-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .enhanced-results::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #8b5cf6, #7c3aed, #8b5cf6);
        }

        .results-tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
        }

        .results-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            border-radius: 8px 8px 0 0;
        }

        .results-tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: var(--highlight-color);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .results-tab.active {
            color: var(--highlight-color);
            background: rgba(233, 69, 96, 0.1);
        }

        .results-tab.active::before {
            width: 80%;
        }

        .results-tab:hover {
            color: var(--text-primary);
            background: rgba(233, 69, 96, 0.05);
        }

        .results-tab-content {
            display: none;
        }

        .results-tab-content.active {
            display: block;
        }

        .quality-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--background-dark);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .quality-bar {
            flex: 1;
            height: 12px;
            background: var(--background-dark);
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .quality-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981);
            border-radius: 6px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .quality-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .quality-text {
            font-weight: 600;
            color: var(--text-primary);
            min-width: 60px;
            text-align: center;
        }

        .compatibility-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .compatibility-item {
            background: var(--background-dark);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .compatibility-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #10b981, #059669);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .compatibility-item.supported {
            border-left: 4px solid #10b981;
        }

        .compatibility-item.supported::before {
            transform: scaleX(1);
        }

        .compatibility-item.not-supported {
            border-left: 4px solid #ef4444;
        }

        .compatibility-item.not-supported::before {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            transform: scaleX(1);
        }

        .compatibility-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .compatibility-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .compatibility-icon.supported {
            color: #10b981;
        }

        .compatibility-icon.not-supported {
            color: #ef4444;
        }

        .compatibility-item:hover .compatibility-icon {
            transform: scale(1.2);
        }

        .compatibility-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .compatibility-item:hover .compatibility-label {
            color: var(--text-primary);
        }

        /* Enhanced Results Styles */
        .warning-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #f59e0b;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .warnings .detail-value {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .m3u8-details {
            background: var(--background-dark);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }

        .m3u8-details h5 {
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .m3u8-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--accent-color);
            border-radius: 6px;
        }

        .info-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .info-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* File Results Enhanced Styles */
        .warnings-section {
            margin-top: 10px;
            padding: 10px;
            background: rgba(245, 158, 11, 0.1);
            border-radius: 6px;
            border-left: 3px solid #f59e0b;
        }

        .warnings-title {
            font-weight: 600;
            color: #f59e0b;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .link-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .link-detail:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .detail-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .iptv-checker-container {
                padding: 15px;
            }

            .checker-header h1 {
                font-size: 2rem;
            }

            .url-input-container {
                flex-direction: column;
            }

            .check-btn {
                width: 100%;
                justify-content: center;
            }

            .result-details {
                grid-template-columns: 1fr;
            }

            .actions-container {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
                min-width: auto;
            }

            .test-buttons {
                flex-direction: column;
            }

            .quick-test-btn {
                width: 100%;
                min-width: auto;
            }

            .file-actions {
                flex-direction: column;
            }

            .file-actions .action-btn {
                width: 100%;
                min-width: auto;
            }

            .back-btn {
                top: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
            }

            .checker-tabs {
                flex-direction: column;
            }

            .checker-tab {
                text-align: center;
                border-bottom: none;
                border-right: 3px solid transparent;
            }

            .checker-tab.active {
                border-bottom-color: transparent;
                border-right-color: var(--highlight-color);
            }

            .comparison-urls {
                grid-template-columns: 1fr;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }

            .check-options {
                grid-template-columns: 1fr;
            }

            .history-controls {
                flex-direction: column;
            }

            .history-btn {
                width: 100%;
                justify-content: center;
            }

            /* Video Player Mobile Styles */
            .video-player-section {
                padding: 15px;
            }

            .player-container {
                max-width: 100%;
            }

            .player-overlay {
                padding: 15px;
            }

            .player-info h3 {
                font-size: 1rem;
            }

            .player-info p {
                font-size: 0.8rem;
            }

            .control-btn {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }

            .player-controls {
                gap: 8px;
            }

            .player-status {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            /* Channels Mobile Styles */
            .channels-section {
                padding: 20px;
            }

            .channels-header {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .channels-actions {
                justify-content: center;
            }

            .channels-tabs {
                flex-direction: column;
            }

            .channel-tab {
                text-align: center;
                border-bottom: none;
                border-right: 3px solid transparent;
            }

            .channel-tab.active {
                border-bottom-color: transparent;
                border-right-color: var(--highlight-color);
            }

            .channel-item {
                padding: 12px;
            }

            .channel-item-header {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .channel-name {
                margin-right: 0;
                text-align: center;
            }

            .channel-actions {
                justify-content: center;
                opacity: 1;
                transform: translateY(0);
            }

            .channel-action-btn {
                flex: 1;
                justify-content: center;
            }

            .channels-list {
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()" title="العودة للصفحة الرئيسية">
        <i class="fas fa-arrow-right"></i>
    </button>

    <div class="iptv-checker-container">
        <div class="checker-header">
            <h1>
                <i class="fas fa-tv"></i>
                مشغل IPTV المباشر
            </h1>
            <p>مشغل احترافي للبث المباشر مع فحص وتحليل الروابط وتشغيلها مباشرة</p>
        </div>

        <!-- Video Player Section -->
        <div class="video-player-section" id="videoPlayerSection" style="display: none;">
            <div class="player-container">
                <div class="video-wrapper">
                    <video id="videoPlayer" class="video-player" controls preload="metadata">
                        <source id="videoSource" src="" type="application/x-mpegURL">
                        متصفحك لا يدعم تشغيل الفيديو
                    </video>
                    <div class="player-overlay" id="playerOverlay">
                        <div class="player-info">
                            <h3 id="currentChannelName">بدون عنوان</h3>
                            <p id="currentChannelUrl">لا يوجد رابط</p>
                        </div>
                        <div class="player-controls">
                            <button class="control-btn" onclick="togglePlayPause()" id="playPauseBtn">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="control-btn" onclick="toggleMute()" id="muteBtn">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <button class="control-btn" onclick="toggleFullscreen()">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="control-btn" onclick="stopStream()">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="player-status" id="playerStatus">
                    <div class="status-indicator">
                        <i class="fas fa-circle status-dot"></i>
                        <span id="statusText">جاهز للتشغيل</span>
                    </div>
                    <div class="quality-info" id="qualityInfo">
                        <span id="currentQuality">جودة تلقائية</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="supported-formats">
            <h3>
                <i class="fas fa-check-circle"></i>
                الصيغ المدعومة
            </h3>
            <div class="formats-grid">
                <div class="format-item">
                    <i class="fas fa-video"></i>
                    <span>M3U8</span>
                </div>
                <div class="format-item">
                    <i class="fas fa-play"></i>
                    <span>MP4</span>
                </div>
                <div class="format-item">
                    <i class="fas fa-stream"></i>
                    <span>RTMP</span>
                </div>
                <div class="format-item">
                    <i class="fas fa-broadcast-tower"></i>
                    <span>RTSP</span>
                </div>
                <div class="format-item">
                    <i class="fas fa-globe"></i>
                    <span>HTTP/HTTPS</span>
                </div>
                <div class="format-item">
                    <i class="fas fa-shield-alt"></i>
                    <span>HLS</span>
                </div>
            </div>
        </div>

        <!-- Channels Management -->
        <div class="channels-section">
            <div class="channels-header">
                <h3>
                    <i class="fas fa-list"></i>
                    إدارة القنوات
                </h3>
                <div class="channels-actions">
                    <button class="action-btn" onclick="addToFavorites()" id="addToFavoritesBtn" style="display: none;">
                        <i class="fas fa-heart"></i>
                        إضافة للمفضلة
                    </button>
                    <button class="action-btn" onclick="clearFavorites()">
                        <i class="fas fa-trash"></i>
                        مسح المفضلة
                    </button>
                </div>
            </div>
            
            <div class="channels-tabs">
                <button class="channel-tab active" data-tab="favorites">المفضلة</button>
                <button class="channel-tab" data-tab="recent">الأحدث</button>
                <button class="channel-tab" data-tab="working">العاملة</button>
            </div>
            
            <div class="channels-content">
                <div class="channel-tab-content active" id="favoritesTab">
                    <div class="channels-list" id="favoritesList">
                        <div class="empty-state">
                            <i class="fas fa-heart"></i>
                            <p>لا توجد قنوات في المفضلة</p>
                        </div>
                    </div>
                </div>
                
                <div class="channel-tab-content" id="recentTab">
                    <div class="channels-list" id="recentList">
                        <div class="empty-state">
                            <i class="fas fa-clock"></i>
                            <p>لا توجد قنوات حديثة</p>
                        </div>
                    </div>
                </div>
                
                <div class="channel-tab-content" id="workingTab">
                    <div class="channels-list" id="workingList">
                        <div class="empty-state">
                            <i class="fas fa-check-circle"></i>
                            <p>لا توجد قنوات عاملة</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="quick-tests">
            <h3>
                <i class="fas fa-bolt"></i>
                اختبارات سريعة
            </h3>
            <div class="test-buttons">
                <button class="quick-test-btn" onclick="testAndPlay('https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8', 'فيلم تجريبي')">
                    <i class="fas fa-play"></i>
                    رابط تجريبي
                </button>
                <button class="quick-test-btn" onclick="testAndPlay('https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8', 'بث تجريبي')">
                    <i class="fas fa-video"></i>
                    بث تجريبي
                </button>
                <button class="quick-test-btn" onclick="testAndPlay('https://cph-p2p-msl.akamaized.net/hls/live/2000341/test/master.m3u8', 'بث مباشر')">
                    <i class="fas fa-broadcast-tower"></i>
                    بث مباشر
                </button>
                <button class="quick-test-btn" onclick="openAdvancedChecker()">
                    <i class="fas fa-cogs"></i>
                    فحص متقدم
                </button>
            </div>
        </div>

        <!-- Advanced Checker Modal -->
        <div class="modal" id="advancedCheckerModal">
            <div class="modal-content advanced-checker-content">
                <div class="modal-header">
                    <h3><i class="fas fa-cogs"></i> فحص متقدم للروابط</h3>
                    <button class="close-btn" onclick="closeAdvancedChecker()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="advanced-checker-body">
                    <div class="checker-tabs">
                        <button class="checker-tab active" data-tab="single">فحص رابط واحد</button>
                        <button class="checker-tab" data-tab="multiple">فحص متعدد</button>
                        <button class="checker-tab" data-tab="comparison">مقارنة الروابط</button>
                        <button class="checker-tab" data-tab="history">سجل الفحوصات</button>
                    </div>
                    
                    <!-- Single URL Check Tab -->
                    <div class="checker-tab-content active" id="singleTab">
                        <div class="advanced-form">
                            <div class="form-group">
                                <label for="advancedUrlInput">رابط البث</label>
                                <input type="url" id="advancedUrlInput" class="advanced-input" placeholder="أدخل رابط البث المباشر">
                            </div>
                            <div class="form-group">
                                <label for="checkOptions">خيارات الفحص</label>
                                <div class="check-options">
                                    <label class="option-item">
                                        <input type="checkbox" id="checkConnectivity" checked>
                                        <span>فحص الاتصال</span>
                                    </label>
                                    <label class="option-item">
                                        <input type="checkbox" id="checkQuality" checked>
                                        <span>تحليل الجودة</span>
                                    </label>
                                    <label class="option-item">
                                        <input type="checkbox" id="checkCompatibility" checked>
                                        <span>فحص التوافق</span>
                                    </label>
                                    <label class="option-item">
                                        <input type="checkbox" id="checkPerformance" checked>
                                        <span>قياس الأداء</span>
                                    </label>
                                </div>
                            </div>
                            <button class="advanced-check-btn" onclick="performAdvancedCheck()">
                                <i class="fas fa-search"></i>
                                بدء الفحص المتقدم
                            </button>
                        </div>
                    </div>
                    
                    <!-- Multiple URLs Check Tab -->
                    <div class="checker-tab-content" id="multipleTab">
                        <div class="multiple-urls-form">
                            <div class="form-group">
                                <label for="multipleUrlsInput">روابط متعددة (واحد في كل سطر)</label>
                                <textarea id="multipleUrlsInput" class="advanced-textarea" placeholder="https://example1.com/stream.m3u8&#10;https://example2.com/stream.m3u8&#10;https://example3.com/stream.m3u8" rows="8"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="batchSize">حجم الدفعة</label>
                                <select id="batchSize" class="advanced-select">
                                    <option value="3">3 روابط</option>
                                    <option value="5" selected>5 روابط</option>
                                    <option value="10">10 روابط</option>
                                    <option value="20">20 رابط</option>
                                </select>
                            </div>
                            <button class="advanced-check-btn" onclick="performMultipleCheck()">
                                <i class="fas fa-list-check"></i>
                                فحص جميع الروابط
                            </button>
                        </div>
                    </div>
                    
                    <!-- Comparison Tab -->
                    <div class="checker-tab-content" id="comparisonTab">
                        <div class="comparison-form">
                            <div class="comparison-urls">
                                <div class="comparison-item">
                                    <label>الرابط الأول</label>
                                    <input type="url" id="compareUrl1" class="advanced-input" placeholder="الرابط الأول">
                                </div>
                                <div class="comparison-item">
                                    <label>الرابط الثاني</label>
                                    <input type="url" id="compareUrl2" class="advanced-input" placeholder="الرابط الثاني">
                                </div>
                            </div>
                            <button class="advanced-check-btn" onclick="performComparison()">
                                <i class="fas fa-balance-scale"></i>
                                مقارنة الروابط
                            </button>
                        </div>
                    </div>
                    
                    <!-- History Tab -->
                    <div class="checker-tab-content" id="historyTab">
                        <div class="history-controls">
                            <button class="history-btn" onclick="loadHistory()">
                                <i class="fas fa-sync"></i>
                                تحديث السجل
                            </button>
                            <button class="history-btn" onclick="clearHistory()">
                                <i class="fas fa-trash"></i>
                                مسح السجل
                            </button>
                        </div>
                        <div class="history-list" id="historyList">
                            <!-- History items will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-overlay"></div>
        </div>

        <div class="file-checker">
            <h3>
                <i class="fas fa-file-upload"></i>
                فحص ملف الروابط
            </h3>
            <p>ارفع ملف M3U أو M3U8 لفحص جميع الروابط الموجودة فيه</p>
            
            <div class="file-upload-area" id="fileUploadArea">
                <div class="upload-content">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4>اسحب ملف الروابط هنا أو انقر للاختيار</h4>
                    <p>يدعم ملفات M3U, M3U8, TXT</p>
                    <input type="file" id="fileInput" accept=".m3u,.m3u8,.txt" style="display: none;">
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-folder-open"></i>
                        اختيار ملف
                    </button>
                </div>
            </div>

            <div class="file-info" id="fileInfo" style="display: none;">
                <div class="file-details">
                    <div class="file-name">
                        <i class="fas fa-file"></i>
                        <span id="fileName">-</span>
                    </div>
                    <div class="file-size">
                        <i class="fas fa-weight"></i>
                        <span id="fileSize">-</span>
                    </div>
                    <div class="file-links-count">
                        <i class="fas fa-link"></i>
                        <span id="linksCount">-</span> رابط
                    </div>
                </div>
                <div class="file-actions">
                    <button class="action-btn play-btn" onclick="checkAllLinks()" id="checkAllBtn">
                        <i class="fas fa-search"></i>
                        فحص جميع الروابط
                    </button>
                    <button class="action-btn copy-btn" onclick="downloadResults()" id="downloadBtn" style="display: none;">
                        <i class="fas fa-download"></i>
                        تحميل النتائج
                    </button>
                </div>
            </div>
        </div>

        <div class="checker-form">
            <div class="form-group">
                <label for="urlInput">
                    <i class="fas fa-link"></i>
                    رابط البث المباشر
                </label>
                <div class="url-input-container">
                    <input type="url" id="urlInput" class="url-input" placeholder="أدخل رابط البث المباشر (m3u8, mp4, rtmp, rtsp...)" />
                    <button class="check-btn" onclick="checkStream()" id="checkBtn">
                        <i class="fas fa-search"></i>
                        فحص الرابط
                    </button>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="quick-actions">
                <button class="quick-action-btn" onclick="pasteFromClipboard()" title="لصق من الحافظة">
                    <i class="fas fa-paste"></i>
                    لصق
                </button>
                <button class="quick-action-btn" onclick="clearUrl()" title="مسح الرابط">
                    <i class="fas fa-times"></i>
                    مسح
                </button>
                <button class="quick-action-btn" onclick="validateUrl()" title="التحقق من صحة الرابط">
                    <i class="fas fa-check-circle"></i>
                    التحقق
                </button>
            </div>
        </div>

        <!-- Statistics Dashboard -->
        <div class="stats-dashboard" id="statsDashboard" style="display: none;">
            <h3>
                <i class="fas fa-chart-bar"></i>
                إحصائيات الفحوصات
            </h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalChecks">0</div>
                        <div class="stat-label">إجمالي الفحوصات</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-thumbs-up"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="successfulChecks">0</div>
                        <div class="stat-label">فحوصات ناجحة</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="avgResponseTime">0ms</div>
                        <div class="stat-label">متوسط الاستجابة</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="successRate">0%</div>
                        <div class="stat-label">معدل النجاح</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="file-results-container" id="fileResultsContainer" style="display: none;">
            <div class="results-header">
                <h3 class="results-title">
                    <i class="fas fa-list-check"></i>
                    نتائج فحص الملف
                </h3>
                <div class="file-status-badge" id="fileStatusBadge">
                    <i class="fas fa-clock"></i>
                    جاهز للفحص
                </div>
            </div>
            
            <div class="file-progress" id="fileProgress" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0 / 0</div>
            </div>

            <div class="file-summary" id="fileSummary" style="display: none;">
                <div class="summary-stats">
                    <div class="stat-item">
                        <i class="fas fa-check-circle"></i>
                        <span class="stat-label">يعمل</span>
                        <span class="stat-value" id="workingCount">0</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-times-circle"></i>
                        <span class="stat-label">لا يعمل</span>
                        <span class="stat-value" id="brokenCount">0</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <span class="stat-label">متوسط الاستجابة</span>
                        <span class="stat-value" id="avgResponseTime">0ms</span>
                    </div>
                </div>
            </div>

            <div class="links-results" id="linksResults">
                <!-- Links results will be populated here -->
            </div>
        </div>

        <div class="results-container" id="resultsContainer">
            <div class="results-header">
                <h3 class="results-title">
                    <i class="fas fa-chart-line"></i>
                    نتائج الفحص
                </h3>
                <div class="status-badge" id="statusBadge">
                    <i class="fas fa-check"></i>
                    جاهز للفحص
                </div>
            </div>

            <div class="result-details" id="resultDetails">
                <!-- Results will be populated here -->
            </div>

            <div class="stream-info" id="streamInfo" style="display: none;">
                <h4>
                    <i class="fas fa-info-circle"></i>
                    معلومات البث
                </h4>
                <div id="streamDetails">
                    <!-- Stream details will be populated here -->
                </div>
            </div>

            <div class="actions-container" id="actionsContainer" style="display: none;">
                <button class="action-btn play-btn" onclick="playStream()">
                    <i class="fas fa-play"></i>
                    تشغيل البث
                </button>
                <button class="action-btn copy-btn" onclick="copyUrl()">
                    <i class="fas fa-copy"></i>
                    نسخ الرابط
                </button>
                <button class="action-btn test-btn" onclick="testStreamQuality()">
                    <i class="fas fa-tachometer-alt"></i>
                    اختبار الجودة
                </button>
            </div>

            <div class="error-details" id="errorDetails" style="display: none;">
                <h4>
                    <i class="fas fa-exclamation-triangle"></i>
                    تفاصيل الخطأ
                </h4>
                <div id="errorContent">
                    <!-- Error details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUrl = '';
        let streamData = null;
        let fileData = null;
        let fileResults = [];
        let hls = null;
        let currentChannel = null;
        let favorites = JSON.parse(localStorage.getItem('iptvFavorites') || '[]');
        let recentChannels = JSON.parse(localStorage.getItem('iptvRecent') || '[]');
        let workingChannels = JSON.parse(localStorage.getItem('iptvWorking') || '[]');

        function goBack() {
            window.location.href = '../index.html';
        }

        function testSampleUrl(url) {
            document.getElementById('urlInput').value = url;
            checkStream();
        }

        // Video Player Functions
        function testAndPlay(url, name = 'قناة غير محددة') {
            document.getElementById('urlInput').value = url;
            checkAndPlayStream(url, name);
        }

        async function checkAndPlayStream(url, name) {
            const checkBtn = document.getElementById('checkBtn');
            const statusBadge = document.getElementById('statusBadge');
            
            // Update UI
            statusBadge.className = 'status-badge status-loading';
            statusBadge.innerHTML = '<div class="loading-spinner"></div> جاري الفحص...';
            
            checkBtn.disabled = true;
            checkBtn.innerHTML = '<div class="loading-spinner"></div> جاري الفحص...';

            try {
                const result = await performStreamCheck(url);
                if (result.accessible) {
                    playStreamDirect(url, name, result);
                    addToRecent(url, name, result);
                    if (result.status === 'success') {
                        addToWorking(url, name, result);
                    }
                } else {
                    displayError(new Error('الرابط غير متاح'));
                }
            } catch (error) {
                displayError(error);
            } finally {
                checkBtn.disabled = false;
                checkBtn.innerHTML = '<i class="fas fa-search"></i> فحص الرابط';
            }
        }

        function playStreamDirect(url, name, streamInfo = null) {
            const videoPlayer = document.getElementById('videoPlayer');
            const videoSource = document.getElementById('videoSource');
            const videoPlayerSection = document.getElementById('videoPlayerSection');
            const currentChannelName = document.getElementById('currentChannelName');
            const currentChannelUrl = document.getElementById('currentChannelUrl');
            const statusText = document.getElementById('statusText');
            const statusDot = document.querySelector('.status-dot');
            const addToFavoritesBtn = document.getElementById('addToFavoritesBtn');

            // Show player section
            videoPlayerSection.style.display = 'block';
            
            // Update channel info
            currentChannelName.textContent = name;
            currentChannelUrl.textContent = url;
            
            // Store current channel
            currentChannel = { url, name, streamInfo };
            
            // Show add to favorites button
            addToFavoritesBtn.style.display = 'flex';
            
            // Update status
            statusText.textContent = 'جاري التحميل...';
            statusDot.className = 'status-dot loading';

            // Clean up previous HLS instance
            if (hls) {
                hls.destroy();
                hls = null;
            }

            // Set video source
            videoSource.src = url;
            
            // Check if it's HLS stream
            if (url.includes('.m3u8') && Hls.isSupported()) {
                hls = new Hls({
                    debug: false,
                    enableWorker: true,
                    lowLatencyMode: true,
                    backBufferLength: 90
                });
                
                hls.loadSource(url);
                hls.attachMedia(videoPlayer);
                
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    console.log('HLS manifest loaded');
                    statusText.textContent = 'جاهز للتشغيل';
                    statusDot.className = 'status-dot';
                });
                
                hls.on(Hls.Events.ERROR, function(event, data) {
                    console.error('HLS error:', data);
                    if (data.fatal) {
                        statusText.textContent = 'خطأ في البث';
                        statusDot.className = 'status-dot error';
                        showNotification('خطأ في تحميل البث', 'error');
                    }
                });
                
                hls.on(Hls.Events.LEVEL_SWITCHED, function(event, data) {
                    const level = hls.levels[data.level];
                    if (level) {
                        document.getElementById('currentQuality').textContent = 
                            `${level.height}p (${Math.round(level.bitrate / 1000)}kbps)`;
                    }
                });
            } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                // Native HLS support (Safari)
                videoPlayer.src = url;
                statusText.textContent = 'جاهز للتشغيل';
                statusDot.className = 'status-dot';
            } else {
                // Regular video file
                videoPlayer.src = url;
                statusText.textContent = 'جاهز للتشغيل';
                statusDot.className = 'status-dot';
            }

            // Add event listeners
            videoPlayer.addEventListener('loadstart', () => {
                statusText.textContent = 'جاري التحميل...';
                statusDot.className = 'status-dot loading';
            });

            videoPlayer.addEventListener('canplay', () => {
                statusText.textContent = 'جاهز للتشغيل';
                statusDot.className = 'status-dot';
            });

            videoPlayer.addEventListener('play', () => {
                statusText.textContent = 'جاري التشغيل';
                statusDot.className = 'status-dot playing';
            });

            videoPlayer.addEventListener('pause', () => {
                statusText.textContent = 'متوقف مؤقتاً';
                statusDot.className = 'status-dot paused';
            });

            videoPlayer.addEventListener('error', (e) => {
                console.error('Video error:', e);
                statusText.textContent = 'خطأ في البث';
                statusDot.className = 'status-dot error';
                showNotification('خطأ في تشغيل البث', 'error');
            });

            // Scroll to player
            videoPlayerSection.scrollIntoView({ behavior: 'smooth' });
        }

        function togglePlayPause() {
            const videoPlayer = document.getElementById('videoPlayer');
            const playPauseBtn = document.getElementById('playPauseBtn');
            
            if (videoPlayer.paused) {
                videoPlayer.play();
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                videoPlayer.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        function toggleMute() {
            const videoPlayer = document.getElementById('videoPlayer');
            const muteBtn = document.getElementById('muteBtn');
            
            if (videoPlayer.muted) {
                videoPlayer.muted = false;
                muteBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
            } else {
                videoPlayer.muted = true;
                muteBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
            }
        }

        function toggleFullscreen() {
            const videoPlayer = document.getElementById('videoPlayer');
            
            if (!document.fullscreenElement) {
                videoPlayer.requestFullscreen().catch(err => {
                    console.error('Error attempting to enable fullscreen:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        function stopStream() {
            const videoPlayer = document.getElementById('videoPlayer');
            const videoPlayerSection = document.getElementById('videoPlayerSection');
            const statusText = document.getElementById('statusText');
            const statusDot = document.querySelector('.status-dot');
            const addToFavoritesBtn = document.getElementById('addToFavoritesBtn');
            
            // Stop video
            videoPlayer.pause();
            videoPlayer.src = '';
            videoPlayer.load();
            
            // Clean up HLS
            if (hls) {
                hls.destroy();
                hls = null;
            }
            
            // Reset UI
            statusText.textContent = 'متوقف';
            statusDot.className = 'status-dot';
            addToFavoritesBtn.style.display = 'none';
            
            // Hide player section
            videoPlayerSection.style.display = 'none';
            
            currentChannel = null;
        }

        // Channels Management Functions
        function addToFavorites() {
            if (!currentChannel) return;
            
            const existingIndex = favorites.findIndex(fav => fav.url === currentChannel.url);
            
            if (existingIndex === -1) {
                favorites.unshift({
                    ...currentChannel,
                    addedAt: new Date().toISOString()
                });
                
                localStorage.setItem('iptvFavorites', JSON.stringify(favorites));
                updateChannelsList();
                showNotification('تم إضافة القناة للمفضلة', 'success');
            } else {
                showNotification('القناة موجودة بالفعل في المفضلة', 'info');
            }
        }

        function addToRecent(url, name, streamInfo) {
            const existingIndex = recentChannels.findIndex(ch => ch.url === url);
            
            if (existingIndex !== -1) {
                recentChannels.splice(existingIndex, 1);
            }
            
            recentChannels.unshift({
                url,
                name,
                streamInfo,
                playedAt: new Date().toISOString()
            });
            
            // Keep only last 20
            if (recentChannels.length > 20) {
                recentChannels = recentChannels.slice(0, 20);
            }
            
            localStorage.setItem('iptvRecent', JSON.stringify(recentChannels));
            updateChannelsList();
        }

        function addToWorking(url, name, streamInfo) {
            const existingIndex = workingChannels.findIndex(ch => ch.url === url);
            
            if (existingIndex !== -1) {
                workingChannels.splice(existingIndex, 1);
            }
            
            workingChannels.unshift({
                url,
                name,
                streamInfo,
                lastChecked: new Date().toISOString()
            });
            
            // Keep only last 50
            if (workingChannels.length > 50) {
                workingChannels = workingChannels.slice(0, 50);
            }
            
            localStorage.setItem('iptvWorking', JSON.stringify(workingChannels));
            updateChannelsList();
        }

        function clearFavorites() {
            if (confirm('هل أنت متأكد من مسح جميع القنوات المفضلة؟')) {
                favorites = [];
                localStorage.setItem('iptvFavorites', JSON.stringify(favorites));
                updateChannelsList();
                showNotification('تم مسح المفضلة', 'success');
            }
        }

        function removeFromFavorites(url) {
            favorites = favorites.filter(fav => fav.url !== url);
            localStorage.setItem('iptvFavorites', JSON.stringify(favorites));
            updateChannelsList();
            showNotification('تم حذف القناة من المفضلة', 'success');
        }

        function playChannel(url, name) {
            checkAndPlayStream(url, name);
        }

        function updateChannelsList() {
            updateFavoritesList();
            updateRecentList();
            updateWorkingList();
        }

        function updateFavoritesList() {
            const favoritesList = document.getElementById('favoritesList');
            
            if (favorites.length === 0) {
                favoritesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-heart"></i>
                        <p>لا توجد قنوات في المفضلة</p>
                    </div>
                `;
                return;
            }
            
            favoritesList.innerHTML = favorites.map(channel => `
                <div class="channel-item working" onclick="playChannel('${channel.url}', '${channel.name}')">
                    <div class="channel-item-header">
                        <div class="channel-name">${channel.name}</div>
                        <div class="channel-status working">يعمل</div>
                    </div>
                    <div class="channel-url">${channel.url}</div>
                    <div class="channel-actions">
                        <button class="channel-action-btn" onclick="event.stopPropagation(); playChannel('${channel.url}', '${channel.name}')">
                            <i class="fas fa-play"></i>
                            <span>تشغيل</span>
                        </button>
                        <button class="channel-action-btn" onclick="event.stopPropagation(); removeFromFavorites('${channel.url}')">
                            <i class="fas fa-trash"></i>
                            <span>حذف</span>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateRecentList() {
            const recentList = document.getElementById('recentList');
            
            if (recentChannels.length === 0) {
                recentList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clock"></i>
                        <p>لا توجد قنوات حديثة</p>
                    </div>
                `;
                return;
            }
            
            recentList.innerHTML = recentChannels.map(channel => `
                <div class="channel-item working" onclick="playChannel('${channel.url}', '${channel.name}')">
                    <div class="channel-item-header">
                        <div class="channel-name">${channel.name}</div>
                        <div class="channel-status working">يعمل</div>
                    </div>
                    <div class="channel-url">${channel.url}</div>
                    <div class="channel-actions">
                        <button class="channel-action-btn" onclick="event.stopPropagation(); playChannel('${channel.url}', '${channel.name}')">
                            <i class="fas fa-play"></i>
                            <span>تشغيل</span>
                        </button>
                        <button class="channel-action-btn" onclick="event.stopPropagation(); addToFavoritesFromRecent('${channel.url}', '${channel.name}')">
                            <i class="fas fa-heart"></i>
                            <span>مفضلة</span>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateWorkingList() {
            const workingList = document.getElementById('workingList');
            
            if (workingChannels.length === 0) {
                workingList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <p>لا توجد قنوات عاملة</p>
                    </div>
                `;
                return;
            }
            
            workingList.innerHTML = workingChannels.map(channel => `
                <div class="channel-item working" onclick="playChannel('${channel.url}', '${channel.name}')">
                    <div class="channel-item-header">
                        <div class="channel-name">${channel.name}</div>
                        <div class="channel-status working">يعمل</div>
                    </div>
                    <div class="channel-url">${channel.url}</div>
                    <div class="channel-actions">
                        <button class="channel-action-btn" onclick="event.stopPropagation(); playChannel('${channel.url}', '${channel.name}')">
                            <i class="fas fa-play"></i>
                            <span>تشغيل</span>
                        </button>
                        <button class="channel-action-btn" onclick="event.stopPropagation(); addToFavoritesFromWorking('${channel.url}', '${channel.name}')">
                            <i class="fas fa-heart"></i>
                            <span>مفضلة</span>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function addToFavoritesFromRecent(url, name) {
            const existingIndex = favorites.findIndex(fav => fav.url === url);
            
            if (existingIndex === -1) {
                favorites.unshift({
                    url,
                    name,
                    addedAt: new Date().toISOString()
                });
                
                localStorage.setItem('iptvFavorites', JSON.stringify(favorites));
                updateChannelsList();
                showNotification('تم إضافة القناة للمفضلة', 'success');
            } else {
                showNotification('القناة موجودة بالفعل في المفضلة', 'info');
            }
        }

        function addToFavoritesFromWorking(url, name) {
            addToFavoritesFromRecent(url, name);
        }

        // Channel tabs switching
        function switchChannelTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.channel-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.channel-tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        async function checkStream() {
            const urlInput = document.getElementById('urlInput');
            const checkBtn = document.getElementById('checkBtn');
            const resultsContainer = document.getElementById('resultsContainer');
            const statusBadge = document.getElementById('statusBadge');
            const resultDetails = document.getElementById('resultDetails');
            const streamInfo = document.getElementById('streamInfo');
            const actionsContainer = document.getElementById('actionsContainer');
            const errorDetails = document.getElementById('errorDetails');

            const url = urlInput.value.trim();
            if (!url) {
                showNotification('يرجى إدخال رابط البث', 'error');
                return;
            }

            currentUrl = url;
            
            // Reset UI
            resultsContainer.style.display = 'block';
            streamInfo.style.display = 'none';
            actionsContainer.style.display = 'none';
            errorDetails.style.display = 'none';

            // Update status to loading
            statusBadge.className = 'status-badge status-loading';
            statusBadge.innerHTML = '<div class="loading-spinner"></div> جاري الفحص...';

            checkBtn.disabled = true;
            checkBtn.innerHTML = '<div class="loading-spinner"></div> جاري الفحص...';

            try {
                const result = await performStreamCheck(url);
                displayResults(result);
            } catch (error) {
                displayError(error);
            } finally {
                checkBtn.disabled = false;
                checkBtn.innerHTML = '<i class="fas fa-search"></i> فحص الرابط';
            }
        }

        async function performStreamCheck(url) {
            const startTime = Date.now();
            const results = {
                url: url,
                responseTime: 0,
                statusCode: 0,
                contentType: '',
                accessible: false,
                isM3U8: url.includes('.m3u8'),
                isHLS: false,
                quality: 'unknown',
                error: null,
                warnings: [],
                details: {}
            };

            try {
                // First attempt: Direct HEAD request
                const response = await fetch(url, {
                    method: 'HEAD',
                    mode: 'cors',
                    cache: 'no-cache'
                });

                const endTime = Date.now();
                results.responseTime = endTime - startTime;
                results.statusCode = response.status;

                if (response.ok) {
                    results.accessible = true;
                    results.contentType = response.headers.get('content-type') || '';
                    results.isHLS = results.contentType.includes('application/vnd.apple.mpegurl') || results.isM3U8;
                    
                    // Get additional headers
                    results.details = {
                        contentLength: response.headers.get('content-length'),
                        lastModified: response.headers.get('last-modified'),
                        server: response.headers.get('server'),
                        cacheControl: response.headers.get('cache-control'),
                        expires: response.headers.get('expires'),
                        etag: response.headers.get('etag')
                    };

                    // Analyze quality based on content type and URL
                    results.quality = analyzeStreamQuality(url, results.contentType);
                    
                    // For M3U8 files, try to get more details
                    if (results.isM3U8) {
                        try {
                            const m3u8Response = await fetch(url, { method: 'GET', mode: 'cors' });
                            if (m3u8Response.ok) {
                                const m3u8Content = await m3u8Response.text();
                                results.details.m3u8Info = analyzeM3U8Content(m3u8Content);
                            }
                        } catch (e) {
                            results.warnings.push('لا يمكن تحليل محتوى M3U8');
                        }
                    }

                    return {
                        status: 'success',
                        ...results
                    };
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                // Second attempt: Try with CORS proxy
                try {
                    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
                    const proxyResponse = await fetch(proxyUrl, {
                        method: 'HEAD',
                        cache: 'no-cache'
                    });

                    const endTime = Date.now();
                    results.responseTime = endTime - startTime;
                    results.statusCode = proxyResponse.status;
                    results.accessible = proxyResponse.ok;
                    results.contentType = 'application/octet-stream';
                    results.details.proxyUsed = true;

                    if (proxyResponse.ok) {
                        results.quality = analyzeStreamQuality(url, results.contentType);
                        return {
                            status: 'success',
                            ...results,
                            note: 'تم الوصول عبر خادم وسيط'
                        };
                    } else {
                        throw new Error(`Proxy HTTP ${proxyResponse.status}`);
                    }
                } catch (proxyError) {
                    // Third attempt: Try GET request for some URLs
                    try {
                        const getResponse = await fetch(url, {
                            method: 'GET',
                            mode: 'cors',
                            cache: 'no-cache'
                        });

                        const endTime = Date.now();
                        results.responseTime = endTime - startTime;
                        results.statusCode = getResponse.status;
                        results.accessible = getResponse.ok;
                        results.contentType = getResponse.headers.get('content-type') || '';
                        results.isHLS = results.contentType.includes('application/vnd.apple.mpegurl') || results.isM3U8;

                        if (getResponse.ok) {
                            results.quality = analyzeStreamQuality(url, results.contentType);
                            return {
                                status: 'success',
                                ...results,
                                note: 'تم الوصول عبر GET request'
                            };
                        } else {
                            throw new Error(`GET HTTP ${getResponse.status}`);
                        }
                    } catch (getError) {
                        // Final attempt: Check if URL is valid format
                        const urlValid = isValidStreamUrl(url);
                        results.accessible = false;
                        results.error = error.message;
                        results.details.urlValid = urlValid;
                        
                        if (!urlValid) {
                            results.warnings.push('تنسيق الرابط غير صحيح');
                        }

                        return {
                            status: 'failed',
                            ...results
                        };
                    }
                }
            }
        }

        function analyzeStreamQuality(url, contentType) {
            // Analyze based on URL patterns and content type
            if (url.includes('1080') || url.includes('hd')) return 'high';
            if (url.includes('720') || url.includes('hd')) return 'medium';
            if (url.includes('480') || url.includes('sd')) return 'low';
            if (contentType.includes('video')) return 'medium';
            if (contentType.includes('audio')) return 'low';
            return 'unknown';
        }

        function analyzeM3U8Content(content) {
            const info = {
                hasMultipleBitrates: content.includes('#EXT-X-STREAM-INF'),
                segments: (content.match(/#EXTINF/g) || []).length,
                duration: 0,
                bitrates: [],
                resolutions: []
            };

            // Extract duration
            const durationMatch = content.match(/#EXTINF:([0-9.]+)/);
            if (durationMatch) {
                info.duration = parseFloat(durationMatch[1]);
            }

            // Extract bitrates and resolutions
            const streamInfMatches = content.match(/#EXT-X-STREAM-INF:([^\n]+)/g);
            if (streamInfMatches) {
                streamInfMatches.forEach(match => {
                    const bitrateMatch = match.match(/BANDWIDTH=(\d+)/);
                    const resolutionMatch = match.match(/RESOLUTION=(\d+x\d+)/);
                    
                    if (bitrateMatch) {
                        info.bitrates.push(parseInt(bitrateMatch[1]));
                    }
                    if (resolutionMatch) {
                        info.resolutions.push(resolutionMatch[1]);
                    }
                });
            }

            return info;
        }

        function isValidStreamUrl(url) {
            try {
                const urlObj = new URL(url);
                const validProtocols = ['http:', 'https:', 'rtmp:', 'rtsp:', 'udp:'];
                const validExtensions = ['.m3u8', '.m3u', '.mp4', '.ts', '.flv', '.avi', '.mkv'];
                
                if (!validProtocols.includes(urlObj.protocol)) return false;
                
                // Check if it's a streaming URL or has valid extension
                const hasValidExtension = validExtensions.some(ext => url.toLowerCase().includes(ext));
                const isStreamingUrl = url.includes('stream') || url.includes('live') || url.includes('playlist');
                
                return hasValidExtension || isStreamingUrl;
            } catch (e) {
                return false;
            }
        }

        function displayResults(result) {
            const statusBadge = document.getElementById('statusBadge');
            const resultDetails = document.getElementById('resultDetails');
            const streamInfo = document.getElementById('streamInfo');
            const actionsContainer = document.getElementById('actionsContainer');

            // Update status badge
            if (result.status === 'success' && result.accessible) {
                statusBadge.className = 'status-badge status-success';
                statusBadge.innerHTML = '<i class="fas fa-check"></i> الرابط يعمل';
            } else if (result.status === 'success' && !result.accessible) {
                statusBadge.className = 'status-badge status-warning';
                statusBadge.innerHTML = '<i class="fas fa-exclamation-triangle"></i> الرابط محدود';
            } else {
                statusBadge.className = 'status-badge status-error';
                statusBadge.innerHTML = '<i class="fas fa-times"></i> الرابط لا يعمل';
            }

            // Display enhanced details
            resultDetails.innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">حالة الرابط</div>
                    <div class="detail-value">${result.accessible ? 'يعمل' : 'لا يعمل'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">وقت الاستجابة</div>
                    <div class="detail-value">${result.responseTime}ms</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">كود الحالة</div>
                    <div class="detail-value">${result.statusCode || 'غير محدد'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">نوع المحتوى</div>
                    <div class="detail-value">${result.contentType || 'غير محدد'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">نوع البث</div>
                    <div class="detail-value">${result.isHLS ? 'HLS (M3U8)' : 'بث عادي'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">جودة البث</div>
                    <div class="detail-value">${getQualityText(result.quality)}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">الخادم</div>
                    <div class="detail-value">${result.details?.server || 'غير محدد'}</div>
                </div>
                ${result.details?.proxyUsed ? `
                <div class="detail-item">
                    <div class="detail-label">طريقة الوصول</div>
                    <div class="detail-value">خادم وسيط</div>
                </div>
                ` : ''}
                ${result.note ? `
                <div class="detail-item">
                    <div class="detail-label">ملاحظة</div>
                    <div class="detail-value">${result.note}</div>
                </div>
                ` : ''}
            `;

            // Show warnings if any
            if (result.warnings && result.warnings.length > 0) {
                const warningsHtml = result.warnings.map(warning => 
                    `<div class="warning-item"><i class="fas fa-exclamation-triangle"></i> ${warning}</div>`
                ).join('');
                
                resultDetails.innerHTML += `
                    <div class="detail-item warnings">
                        <div class="detail-label">تحذيرات</div>
                        <div class="detail-value">${warningsHtml}</div>
                    </div>
                `;
            }

            // Show stream info if it's HLS
            if (result.isHLS) {
                streamInfo.style.display = 'block';
                let streamDetailsHtml = `
                    <div class="quality-levels">
                        <span class="quality-badge">HLS</span>
                        <span class="quality-badge">متوافق مع جميع الأجهزة</span>
                        <span class="quality-badge">دعم التكيف التلقائي</span>
                    </div>
                `;

                // Add M3U8 specific info
                if (result.details?.m3u8Info) {
                    const m3u8Info = result.details.m3u8Info;
                    streamDetailsHtml += `
                        <div class="m3u8-details">
                            <h5>تفاصيل M3U8:</h5>
                            <div class="m3u8-info">
                                <div class="info-item">
                                    <span class="info-label">عدد المقاطع:</span>
                                    <span class="info-value">${m3u8Info.segments}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">معدلات البت:</span>
                                    <span class="info-value">${m3u8Info.bitrates.length > 0 ? m3u8Info.bitrates.join(', ') : 'غير محدد'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">الدقة:</span>
                                    <span class="info-value">${m3u8Info.resolutions.length > 0 ? m3u8Info.resolutions.join(', ') : 'غير محدد'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">مدة المقطع:</span>
                                    <span class="info-value">${m3u8Info.duration > 0 ? m3u8Info.duration + ' ثانية' : 'غير محدد'}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }

                document.getElementById('streamDetails').innerHTML = streamDetailsHtml;
            }

            // Show actions
            actionsContainer.style.display = 'flex';

            streamData = result;
        }

        function getQualityText(quality) {
            const qualityMap = {
                'high': 'عالي (1080p+)',
                'medium': 'متوسط (720p)',
                'low': 'منخفض (480p)',
                'unknown': 'غير محدد'
            };
            return qualityMap[quality] || 'غير محدد';
        }

        function displayError(error) {
            const statusBadge = document.getElementById('statusBadge');
            const resultDetails = document.getElementById('resultDetails');
            const errorDetails = document.getElementById('errorDetails');

            statusBadge.className = 'status-badge status-error';
            statusBadge.innerHTML = '<i class="fas fa-times"></i> خطأ في الفحص';

            resultDetails.innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">حالة الرابط</div>
                    <div class="detail-value">لا يعمل</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">نوع الخطأ</div>
                    <div class="detail-value">خطأ في الاتصال</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">السبب المحتمل</div>
                    <div class="detail-value">الرابط غير متاح أو محظور</div>
                </div>
            `;

            errorDetails.style.display = 'block';
            document.getElementById('errorContent').innerHTML = `
                <p><strong>الخطأ:</strong> ${error.message}</p>
                <p><strong>الحلول المقترحة:</strong></p>
                <ul>
                    <li>تأكد من صحة الرابط</li>
                    <li>تحقق من اتصال الإنترنت</li>
                    <li>جرب رابط آخر</li>
                    <li>تأكد من أن الرابط يدعم CORS</li>
                </ul>
            `;
        }

        function playStream() {
            if (currentUrl) {
                // Open in new tab
                window.open(currentUrl, '_blank');
            }
        }

        function copyUrl() {
            if (currentUrl) {
                navigator.clipboard.writeText(currentUrl).then(() => {
                    showNotification('تم نسخ الرابط بنجاح', 'success');
                }).catch(() => {
                    showNotification('فشل في نسخ الرابط', 'error');
                });
            }
        }

        async function testStreamQuality() {
            if (!currentUrl) return;

            const statusBadge = document.getElementById('statusBadge');
            statusBadge.className = 'status-badge status-loading';
            statusBadge.innerHTML = '<div class="loading-spinner"></div> اختبار الجودة...';

            try {
                // Simulate quality test
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                statusBadge.className = 'status-badge status-success';
                statusBadge.innerHTML = '<i class="fas fa-check"></i> الجودة ممتازة';
                
                showNotification('تم اختبار الجودة بنجاح', 'success');
            } catch (error) {
                statusBadge.className = 'status-badge status-error';
                statusBadge.innerHTML = '<i class="fas fa-times"></i> فشل اختبار الجودة';
                showNotification('فشل في اختبار الجودة', 'error');
            }
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}"></i>
                ${message}
            `;

            // Add styles
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 10px;
                font-weight: 600;
                animation: slideDown 0.3s ease;
            `;

            document.body.appendChild(notification);

            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
                to { transform: translateX(-50%) translateY(0); opacity: 1; }
            }
            @keyframes slideUp {
                from { transform: translateX(-50%) translateY(0); opacity: 1; }
                to { transform: translateX(-50%) translateY(-100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Handle Enter key press
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkStream();
            }
        });

        // File handling functions
        function setupFileHandling() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('fileUploadArea');

            // File input change
            fileInput.addEventListener('change', handleFileSelect);

            // Drag and drop
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('click', () => fileInput.click());
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            // Validate file type
            const allowedTypes = ['.m3u', '.m3u8', '.txt'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!allowedTypes.includes(fileExtension)) {
                showNotification('نوع الملف غير مدعوم. يرجى اختيار ملف M3U, M3U8 أو TXT', 'error');
                return;
            }

            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                showNotification('حجم الملف كبير جداً. الحد الأقصى 10 ميجابايت', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                parseFileContent(content, file);
            };
            reader.readAsText(file);
        }

        function parseFileContent(content, file) {
            const lines = content.split('\n');
            const links = [];
            let currentChannel = null;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF:')) {
                    // Parse channel info
                    const match = line.match(/#EXTINF:(-?\d+)(?:\s+(.*))?,(.*)/);
                    if (match) {
                        currentChannel = {
                            duration: match[1],
                            attributes: match[2] || '',
                            name: match[3].trim()
                        };
                    }
                } else if (line && !line.startsWith('#') && (line.startsWith('http') || line.startsWith('rtmp') || line.startsWith('rtsp'))) {
                    // This is a URL
                    if (currentChannel) {
                        links.push({
                            name: currentChannel.name,
                            url: line,
                            duration: currentChannel.duration,
                            attributes: currentChannel.attributes
                        });
                        currentChannel = null;
                    } else {
                        // URL without channel info
                        links.push({
                            name: `رابط ${links.length + 1}`,
                            url: line,
                            duration: '-1',
                            attributes: ''
                        });
                    }
                }
            }

            fileData = {
                name: file.name,
                size: file.size,
                links: links
            };

            displayFileInfo();
        }

        function displayFileInfo() {
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const linksCount = document.getElementById('linksCount');

            fileName.textContent = fileData.name;
            fileSize.textContent = formatFileSize(fileData.size);
            linksCount.textContent = fileData.links.length;

            fileInfo.style.display = 'block';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 بايت';
            const k = 1024;
            const sizes = ['بايت', 'كيلوبايت', 'ميجابايت', 'جيجابايت'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function checkAllLinks() {
            if (!fileData || fileData.links.length === 0) {
                showNotification('لا توجد روابط للفحص', 'error');
                return;
            }

            const fileResultsContainer = document.getElementById('fileResultsContainer');
            const fileProgress = document.getElementById('fileProgress');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const checkAllBtn = document.getElementById('checkAllBtn');

            // Show results container
            fileResultsContainer.style.display = 'block';
            fileProgress.style.display = 'block';

            // Reset results
            fileResults = [];
            checkAllBtn.disabled = true;
            checkAllBtn.innerHTML = '<div class="loading-spinner"></div> جاري الفحص...';

            const totalLinks = fileData.links.length;
            let checkedLinks = 0;

            // Update status badge
            const fileStatusBadge = document.getElementById('fileStatusBadge');
            fileStatusBadge.className = 'file-status-badge status-loading';
            fileStatusBadge.innerHTML = '<div class="loading-spinner"></div> جاري فحص الروابط...';

            // Check links in batches to avoid overwhelming the browser
            const batchSize = 5;
            for (let i = 0; i < totalLinks; i += batchSize) {
                const batch = fileData.links.slice(i, i + batchSize);
                const batchPromises = batch.map(async (link) => {
                    try {
                        const result = await performStreamCheck(link.url);
                        return {
                            ...link,
                            status: result.accessible ? 'working' : 'broken',
                            responseTime: result.responseTime,
                            statusCode: result.statusCode,
                            contentType: result.contentType,
                            quality: result.quality,
                            isHLS: result.isHLS,
                            warnings: result.warnings || [],
                            error: result.error || null,
                            details: result.details || {}
                        };
                    } catch (error) {
                        return {
                            ...link,
                            status: 'broken',
                            error: error.message,
                            responseTime: 0,
                            statusCode: 0,
                            contentType: '',
                            quality: 'unknown',
                            isHLS: false,
                            warnings: [],
                            details: {}
                        };
                    }
                });

                const batchResults = await Promise.all(batchPromises);
                fileResults.push(...batchResults);

                checkedLinks += batch.length;
                const progress = (checkedLinks / totalLinks) * 100;
                
                progressFill.style.width = progress + '%';
                progressText.textContent = `${checkedLinks} / ${totalLinks}`;

                // Update UI with new results
                updateFileResults();
            }

            // Finalize results
            checkAllBtn.disabled = false;
            checkAllBtn.innerHTML = '<i class="fas fa-search"></i> فحص جميع الروابط';
            
            fileStatusBadge.className = 'file-status-badge status-success';
            fileStatusBadge.innerHTML = '<i class="fas fa-check"></i> تم الفحص بنجاح';

            fileProgress.style.display = 'none';
            document.getElementById('fileSummary').style.display = 'block';
            document.getElementById('downloadBtn').style.display = 'flex';

            updateFileSummary();
            showNotification(`تم فحص ${totalLinks} رابط بنجاح`, 'success');
        }

        function updateFileResults() {
            const linksResults = document.getElementById('linksResults');
            linksResults.innerHTML = '';

            fileResults.forEach((result, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = `link-result-item ${result.status}`;
                
                resultItem.innerHTML = `
                    <div class="link-result-header">
                        <div class="link-name">${result.name}</div>
                        <div class="link-status ${result.status}">
                            ${result.status === 'working' ? 'يعمل' : 'لا يعمل'}
                        </div>
                    </div>
                    <div class="link-url" onclick="copyLinkToClipboard('${result.url}', this)">${result.url}</div>
                    <div class="link-details">
                        <div class="link-detail">
                            <span class="detail-label">الاستجابة:</span>
                            <span class="detail-value">${result.responseTime || 0}ms</span>
                        </div>
                        <div class="link-detail">
                            <span class="detail-label">الكود:</span>
                            <span class="detail-value">${result.statusCode || 'غير محدد'}</span>
                        </div>
                        <div class="link-detail">
                            <span class="detail-label">النوع:</span>
                            <span class="detail-value">${result.contentType || 'غير محدد'}</span>
                        </div>
                        <div class="link-detail">
                            <span class="detail-label">الجودة:</span>
                            <span class="detail-value">${getQualityText(result.quality)}</span>
                        </div>
                        ${result.isHLS ? `
                        <div class="link-detail">
                            <span class="detail-label">نوع البث:</span>
                            <span class="detail-value">HLS (M3U8)</span>
                        </div>
                        ` : ''}
                    </div>
                    ${result.warnings && result.warnings.length > 0 ? `
                        <div class="warnings-section">
                            <div class="warnings-title">تحذيرات:</div>
                            ${result.warnings.map(warning => `
                                <div class="warning-item">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    ${warning}
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    ${result.error ? `
                        <div class="error-details">
                            <strong>خطأ:</strong> ${result.error}
                        </div>
                    ` : ''}
                `;

                linksResults.appendChild(resultItem);
            });
        }

        function updateFileSummary() {
            const workingCount = fileResults.filter(r => r.status === 'working').length;
            const brokenCount = fileResults.filter(r => r.status === 'broken').length;
            const hlsCount = fileResults.filter(r => r.isHLS).length;
            const highQualityCount = fileResults.filter(r => r.quality === 'high').length;
            const avgResponseTime = fileResults
                .filter(r => r.status === 'working')
                .reduce((sum, r) => sum + (r.responseTime || 0), 0) / workingCount || 0;

            document.getElementById('workingCount').textContent = workingCount;
            document.getElementById('brokenCount').textContent = brokenCount;
            document.getElementById('avgResponseTime').textContent = Math.round(avgResponseTime) + 'ms';
            
            // Update additional stats if elements exist
            const hlsCountEl = document.getElementById('hlsCount');
            const highQualityCountEl = document.getElementById('highQualityCount');
            
            if (hlsCountEl) hlsCountEl.textContent = hlsCount;
            if (highQualityCountEl) highQualityCountEl.textContent = highQualityCount;
        }

        function downloadResults() {
            if (fileResults.length === 0) {
                showNotification('لا توجد نتائج للتحميل', 'error');
                return;
            }

            const results = {
                fileName: fileData.name,
                checkedAt: new Date().toLocaleString('ar-SA'),
                totalLinks: fileResults.length,
                workingLinks: fileResults.filter(r => r.status === 'working').length,
                brokenLinks: fileResults.filter(r => r.status === 'broken').length,
                results: fileResults
            };

            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `iptv-check-results-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('تم تحميل النتائج بنجاح', 'success');
        }

        function copyLinkToClipboard(url, element) {
            // Add visual feedback
            element.classList.add('copied');
            
            // Copy to clipboard
            navigator.clipboard.writeText(url).then(() => {
                showNotification('تم نسخ الرابط بنجاح', 'success');
                
                // Remove visual feedback after animation
                setTimeout(() => {
                    element.classList.remove('copied');
                }, 600);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showNotification('تم نسخ الرابط بنجاح', 'success');
                } catch (err) {
                    showNotification('فشل في نسخ الرابط', 'error');
                }
                document.body.removeChild(textArea);
                
                // Remove visual feedback
                setTimeout(() => {
                    element.classList.remove('copied');
                }, 600);
            });
        }

        // Advanced Checker Functions
        let checkHistory = JSON.parse(localStorage.getItem('iptvCheckHistory') || '[]');
        let currentComparison = null;

        function openAdvancedChecker() {
            document.getElementById('advancedCheckerModal').style.display = 'flex';
            loadHistory();
        }

        function closeAdvancedChecker() {
            document.getElementById('advancedCheckerModal').style.display = 'none';
        }

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.checker-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.checker-tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        // Add event listeners for tabs
        document.addEventListener('DOMContentLoaded', function() {
            setupFileHandling();
            
            // Tab switching
            document.querySelectorAll('.checker-tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
        });

        async function performAdvancedCheck() {
            const url = document.getElementById('advancedUrlInput').value.trim();
            if (!url) {
                showNotification('يرجى إدخال رابط البث', 'error');
                return;
            }

            const options = {
                connectivity: document.getElementById('checkConnectivity').checked,
                quality: document.getElementById('checkQuality').checked,
                compatibility: document.getElementById('checkCompatibility').checked,
                performance: document.getElementById('checkPerformance').checked
            };

            try {
                const result = await performAdvancedStreamCheck(url, options);
                displayAdvancedResults(result);
                saveToHistory(url, result);
            } catch (error) {
                showNotification('فشل في الفحص المتقدم', 'error');
                console.error('Advanced check error:', error);
            }
        }

        async function performAdvancedStreamCheck(url, options) {
            const startTime = Date.now();
            const results = {
                url: url,
                timestamp: new Date().toISOString(),
                options: options,
                metrics: {}
            };

            try {
                // Basic connectivity check
                if (options.connectivity) {
                    const response = await fetch(url, { method: 'HEAD', mode: 'cors' });
                    results.metrics.connectivity = {
                        status: response.ok ? 'success' : 'failed',
                        statusCode: response.status,
                        responseTime: Date.now() - startTime,
                        headers: Object.fromEntries(response.headers.entries())
                    };
                }

                // Quality analysis
                if (options.quality && url.includes('.m3u8')) {
                    results.metrics.quality = await analyzeStreamQuality(url);
                }

                // Compatibility check
                if (options.compatibility) {
                    results.metrics.compatibility = await checkCompatibility(url);
                }

                // Performance metrics
                if (options.performance) {
                    results.metrics.performance = await measurePerformance(url);
                }

                // Calculate overall score
                results.overallScore = calculateOverallScore(results.metrics);
                results.status = results.overallScore > 70 ? 'excellent' : results.overallScore > 50 ? 'good' : 'poor';

                return results;
            } catch (error) {
                results.error = error.message;
                results.status = 'failed';
                return results;
            }
        }

        async function analyzeStreamQuality(url) {
            try {
                // Simulate quality analysis
                const response = await fetch(url);
                const content = await response.text();
                
                const quality = {
                    isHLS: url.includes('.m3u8'),
                    hasMultipleBitrates: content.includes('#EXT-X-STREAM-INF'),
                    estimatedBitrate: Math.floor(Math.random() * 5000) + 1000, // Simulated
                    resolution: content.includes('1080') ? '1080p' : content.includes('720') ? '720p' : '480p',
                    codec: content.includes('avc1') ? 'H.264' : 'Unknown',
                    segments: (content.match(/#EXTINF/g) || []).length
                };

                return quality;
            } catch (error) {
                return { error: error.message };
            }
        }

        async function checkCompatibility(url) {
            const compatibility = {
                browsers: {
                    chrome: true,
                    firefox: true,
                    safari: true,
                    edge: true
                },
                devices: {
                    desktop: true,
                    mobile: true,
                    tablet: true
                },
                protocols: {
                    http: url.startsWith('http://'),
                    https: url.startsWith('https://'),
                    hls: url.includes('.m3u8'),
                    rtmp: url.startsWith('rtmp://'),
                    rtsp: url.startsWith('rtsp://')
                }
            };

            return compatibility;
        }

        async function measurePerformance(url) {
            const startTime = performance.now();
            
            try {
                const response = await fetch(url, { method: 'HEAD' });
                const endTime = performance.now();
                
                return {
                    responseTime: Math.round(endTime - startTime),
                    contentLength: response.headers.get('content-length'),
                    server: response.headers.get('server'),
                    cacheControl: response.headers.get('cache-control'),
                    lastModified: response.headers.get('last-modified')
                };
            } catch (error) {
                return { error: error.message };
            }
        }

        function calculateOverallScore(metrics) {
            let score = 0;
            let factors = 0;

            if (metrics.connectivity) {
                score += metrics.connectivity.status === 'success' ? 30 : 0;
                factors++;
            }

            if (metrics.quality) {
                const qualityScore = metrics.quality.isHLS ? 25 : 15;
                score += qualityScore;
                factors++;
            }

            if (metrics.performance) {
                const perfScore = metrics.performance.responseTime < 1000 ? 25 : 
                                metrics.performance.responseTime < 3000 ? 15 : 5;
                score += perfScore;
                factors++;
            }

            if (metrics.compatibility) {
                const compatScore = Object.values(metrics.compatibility.browsers).every(Boolean) ? 20 : 10;
                score += compatScore;
                factors++;
            }

            return factors > 0 ? Math.round(score / factors) : 0;
        }

        function displayAdvancedResults(result) {
            // This would display the advanced results in a detailed format
            console.log('Advanced check results:', result);
            showNotification(`تم الفحص المتقدم بنجاح - النتيجة: ${result.overallScore}/100`, 'success');
        }

        async function performMultipleCheck() {
            const urlsText = document.getElementById('multipleUrlsInput').value.trim();
            if (!urlsText) {
                showNotification('يرجى إدخال الروابط', 'error');
                return;
            }

            const urls = urlsText.split('\n').filter(url => url.trim());
            const batchSize = parseInt(document.getElementById('batchSize').value);
            
            showNotification(`بدء فحص ${urls.length} رابط...`, 'info');

            for (let i = 0; i < urls.length; i += batchSize) {
                const batch = urls.slice(i, i + batchSize);
                const promises = batch.map(async (url) => {
                    try {
                        const result = await performStreamCheck(url.trim());
                        return { url: url.trim(), result, status: 'success' };
                    } catch (error) {
                        return { url: url.trim(), error: error.message, status: 'failed' };
                    }
                });

                const batchResults = await Promise.all(promises);
                console.log(`Batch ${Math.floor(i/batchSize) + 1} results:`, batchResults);
                
                // Add delay between batches
                if (i + batchSize < urls.length) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }

            showNotification(`تم فحص جميع الروابط بنجاح`, 'success');
        }

        async function performComparison() {
            const url1 = document.getElementById('compareUrl1').value.trim();
            const url2 = document.getElementById('compareUrl2').value.trim();

            if (!url1 || !url2) {
                showNotification('يرجى إدخال رابطين للمقارنة', 'error');
                return;
            }

            showNotification('جاري مقارنة الروابط...', 'info');

            try {
                const [result1, result2] = await Promise.all([
                    performStreamCheck(url1),
                    performStreamCheck(url2)
                ]);

                const comparison = {
                    url1: { url: url1, result: result1 },
                    url2: { url: url2, result: result2 },
                    winner: result1.responseTime < result2.responseTime ? 'url1' : 'url2'
                };

                displayComparisonResults(comparison);
                currentComparison = comparison;
            } catch (error) {
                showNotification('فشل في مقارنة الروابط', 'error');
            }
        }

        function displayComparisonResults(comparison) {
            // This would display comparison results
            console.log('Comparison results:', comparison);
            showNotification('تمت المقارنة بنجاح', 'success');
        }

        function saveToHistory(url, result) {
            const historyItem = {
                id: Date.now(),
                url: url,
                timestamp: new Date().toISOString(),
                status: result.status || 'unknown',
                score: result.overallScore || 0,
                responseTime: result.metrics?.connectivity?.responseTime || 0
            };

            checkHistory.unshift(historyItem);
            
            // Keep only last 50 items
            if (checkHistory.length > 50) {
                checkHistory = checkHistory.slice(0, 50);
            }

            localStorage.setItem('iptvCheckHistory', JSON.stringify(checkHistory));
        }

        function loadHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';

            if (checkHistory.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">لا توجد فحوصات سابقة</p>';
                return;
            }

            checkHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-url">${item.url}</div>
                        <div class="history-status ${item.status}">${item.status === 'excellent' ? 'ممتاز' : item.status === 'good' ? 'جيد' : item.status === 'poor' ? 'ضعيف' : 'غير محدد'}</div>
                    </div>
                    <div class="history-details">
                        <div><strong>التاريخ:</strong> ${new Date(item.timestamp).toLocaleString('ar-SA')}</div>
                        <div><strong>النتيجة:</strong> ${item.score}/100</div>
                        <div><strong>الاستجابة:</strong> ${item.responseTime}ms</div>
                    </div>
                    <div class="history-actions">
                        <button class="history-action-btn" onclick="retestUrl('${item.url}')">
                            <i class="fas fa-redo"></i> إعادة فحص
                        </button>
                        <button class="history-action-btn" onclick="copyUrl('${item.url}')">
                            <i class="fas fa-copy"></i> نسخ
                        </button>
                        <button class="history-action-btn" onclick="removeFromHistory(${item.id})">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                `;
                historyList.appendChild(historyItem);
            });
        }

        function clearHistory() {
            if (confirm('هل أنت متأكد من حذف سجل الفحوصات؟')) {
                checkHistory = [];
                localStorage.removeItem('iptvCheckHistory');
                loadHistory();
                showNotification('تم مسح السجل', 'success');
            }
        }

        function retestUrl(url) {
            document.getElementById('advancedUrlInput').value = url;
            switchTab('single');
            performAdvancedCheck();
        }

        function removeFromHistory(id) {
            checkHistory = checkHistory.filter(item => item.id !== id);
            localStorage.setItem('iptvCheckHistory', JSON.stringify(checkHistory));
            loadHistory();
            showNotification('تم حذف العنصر من السجل', 'success');
        }

        // Quick Actions Functions
        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('urlInput').value = text;
                showNotification('تم لصق الرابط من الحافظة', 'success');
            } catch (error) {
                showNotification('فشل في قراءة الحافظة', 'error');
            }
        }

        function clearUrl() {
            document.getElementById('urlInput').value = '';
            showNotification('تم مسح الرابط', 'info');
        }

        function validateUrl() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) {
                showNotification('يرجى إدخال رابط أولاً', 'error');
                return;
            }

            try {
                new URL(url);
                showNotification('الرابط صحيح', 'success');
            } catch (error) {
                showNotification('الرابط غير صحيح', 'error');
            }
        }

        // Statistics Functions
        function updateStatistics() {
            const stats = JSON.parse(localStorage.getItem('iptvStats') || '{"total": 0, "successful": 0, "responseTimes": []}');
            
            document.getElementById('totalChecks').textContent = stats.total;
            document.getElementById('successfulChecks').textContent = stats.successful;
            
            const avgResponseTime = stats.responseTimes.length > 0 
                ? Math.round(stats.responseTimes.reduce((a, b) => a + b, 0) / stats.responseTimes.length)
                : 0;
            document.getElementById('avgResponseTime').textContent = avgResponseTime + 'ms';
            
            const successRate = stats.total > 0 ? Math.round((stats.successful / stats.total) * 100) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            // Show dashboard if there are stats
            if (stats.total > 0) {
                document.getElementById('statsDashboard').style.display = 'block';
            }
        }

        function saveStats(isSuccess, responseTime) {
            const stats = JSON.parse(localStorage.getItem('iptvStats') || '{"total": 0, "successful": 0, "responseTimes": []}');
            
            stats.total++;
            if (isSuccess) {
                stats.successful++;
            }
            if (responseTime) {
                stats.responseTimes.push(responseTime);
                // Keep only last 100 response times
                if (stats.responseTimes.length > 100) {
                    stats.responseTimes = stats.responseTimes.slice(-100);
                }
            }
            
            localStorage.setItem('iptvStats', JSON.stringify(stats));
            updateStatistics();
        }

        // Enhanced display functions
        function displayEnhancedResults(result) {
            const resultsContainer = document.getElementById('resultsContainer');
            
            // Add enhanced results section
            const enhancedResults = document.createElement('div');
            enhancedResults.className = 'enhanced-results';
            enhancedResults.innerHTML = `
                <div class="results-tabs">
                    <button class="results-tab active" data-tab="overview">نظرة عامة</button>
                    <button class="results-tab" data-tab="quality">الجودة</button>
                    <button class="results-tab" data-tab="compatibility">التوافق</button>
                    <button class="results-tab" data-tab="performance">الأداء</button>
                </div>
                
                <div class="results-tab-content active" id="overviewTab">
                    <div class="quality-indicator">
                        <span class="quality-text">الجودة:</span>
                        <div class="quality-bar">
                            <div class="quality-fill" style="width: ${result.overallScore || 0}%"></div>
                        </div>
                        <span class="quality-text">${result.overallScore || 0}/100</span>
                    </div>
                    <div class="result-details">
                        <div class="detail-item">
                            <div class="detail-label">حالة الرابط</div>
                            <div class="detail-value">${result.accessible ? 'يعمل' : 'لا يعمل'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">وقت الاستجابة</div>
                            <div class="detail-value">${result.responseTime}ms</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">نوع البث</div>
                            <div class="detail-value">${result.isHLS ? 'HLS (M3U8)' : 'بث عادي'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="results-tab-content" id="qualityTab">
                    <div class="quality-metrics">
                        <div class="quality-metric">
                            <div class="quality-metric-value">${result.isHLS ? 'HLS' : 'عادي'}</div>
                            <div class="quality-metric-label">نوع البث</div>
                        </div>
                        <div class="quality-metric">
                            <div class="quality-metric-value">${result.contentType || 'غير محدد'}</div>
                            <div class="quality-metric-label">نوع المحتوى</div>
                        </div>
                        <div class="quality-metric">
                            <div class="quality-metric-value">${result.server || 'غير محدد'}</div>
                            <div class="quality-metric-label">الخادم</div>
                        </div>
                    </div>
                </div>
                
                <div class="results-tab-content" id="compatibilityTab">
                    <div class="compatibility-grid">
                        <div class="compatibility-item supported">
                            <div class="compatibility-icon supported">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="compatibility-label">Chrome</div>
                        </div>
                        <div class="compatibility-item supported">
                            <div class="compatibility-icon supported">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="compatibility-label">Firefox</div>
                        </div>
                        <div class="compatibility-item supported">
                            <div class="compatibility-icon supported">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="compatibility-label">Safari</div>
                        </div>
                        <div class="compatibility-item supported">
                            <div class="compatibility-icon supported">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="compatibility-label">Edge</div>
                        </div>
                    </div>
                </div>
                
                <div class="results-tab-content" id="performanceTab">
                    <div class="result-details">
                        <div class="detail-item">
                            <div class="detail-label">وقت الاستجابة</div>
                            <div class="detail-value">${result.responseTime}ms</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">حجم المحتوى</div>
                            <div class="detail-value">${result.contentLength || 'غير محدد'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">آخر تعديل</div>
                            <div class="detail-value">${result.lastModified || 'غير محدد'}</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Insert before existing results
            resultsContainer.insertBefore(enhancedResults, resultsContainer.firstChild);
            
            // Add tab switching functionality
            enhancedResults.querySelectorAll('.results-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs and contents
                    enhancedResults.querySelectorAll('.results-tab').forEach(t => t.classList.remove('active'));
                    enhancedResults.querySelectorAll('.results-tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active class to selected tab and content
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab + 'Tab').classList.add('active');
                });
            });
        }

        // Override the original displayResults function
        const originalDisplayResults = displayResults;
        displayResults = function(result) {
            originalDisplayResults(result);
            displayEnhancedResults(result);
            saveStats(result.accessible, result.responseTime);
        };

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setupFileHandling();
            updateStatistics();
            updateChannelsList();
            
            // Tab switching for advanced checker
            document.querySelectorAll('.checker-tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            // Channel tabs switching
            document.querySelectorAll('.channel-tab').forEach(tab => {
                tab.addEventListener('click', () => switchChannelTab(tab.dataset.tab));
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.code === 'Space' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    togglePlayPause();
                }
                if (e.code === 'KeyM' && e.ctrlKey) {
                    e.preventDefault();
                    toggleMute();
                }
                if (e.code === 'KeyF' && e.ctrlKey) {
                    e.preventDefault();
                    toggleFullscreen();
                }
            });
        });
    </script>
</body>
</html>
